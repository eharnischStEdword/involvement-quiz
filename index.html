<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stepping into St. Edward Church</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚õ™</text></svg>">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #005921 0%, #004a1e 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .header {
            background: #005921;
            padding: 1.5rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            padding: 0 1rem;
        }

        .logo-text {
            color: #EEF4F1;
            font-size: 2.2rem;
            font-weight: 300;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: rgba(238, 244, 241, 0.9);
            font-size: 1.1rem;
        }

        .theme-verse {
            color: rgba(238, 244, 241, 0.8);
            font-size: 0.9rem;
            font-style: italic;
            margin-top: 0.5rem;
            border-top: 1px solid rgba(238, 244, 241, 0.3);
            padding-top: 0.5rem;
        }

        .container {
            max-width: 700px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .main-card {
            background: rgba(238, 244, 241, 0.98);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card-header {
            background: linear-gradient(135deg, #00843D 0%, #005921 100%);
            color: #EEF4F1;
            padding: 2rem 1rem;
            text-align: center;
            position: relative;
        }

        .card-header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            font-weight: 400;
        }

        .card-header p {
            opacity: 0.9;
            font-size: 1rem;
            line-height: 1.4;
        }

        .card-content {
            padding: 2rem 1.5rem;
        }

        .progress {
            width: 100%;
            height: 8px;
            background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%);
            border-radius: 10px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #00843D 0%, #005921 100%);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .question {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .question.active {
            display: block;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .question h2 {
            color: #2c3e50;
            font-size: 1.4rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
            line-height: 1.3;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 2rem;
        }

        .option-btn {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #2c3e50;
            border: 2px solid #dee2e6;
            padding: 1rem 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            line-height: 1.3;
            user-select: none;
            -webkit-user-select: none;
        }

        .option-btn:hover {
            background: linear-gradient(135deg, #005921 0%, #004a1e 100%);
            color: #EEF4F1;
            border-color: #005921;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 89, 33, 0.3);
        }

        .option-btn.selected {
            background: linear-gradient(135deg, #00843D 0%, #005921 100%);
            color: #EEF4F1;
            border-color: #005921;
            box-shadow: 0 6px 20px rgba(0, 89, 33, 0.4);
        }

        .checkbox-group {
            display: grid;
            gap: 12px;
            margin-top: 2rem;
        }

        .checkbox-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .checkbox-item:hover {
            border-color: #005921;
            background: linear-gradient(135deg, #f0f8f4 0%, #e8f5e8 100%);
        }

        .checkbox-item.selected {
            background: linear-gradient(135deg, #00843D 0%, #005921 100%);
            color: #EEF4F1;
            border-color: #005921;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #005921;
        }

        .checkbox-item.selected input[type="checkbox"] {
            accent-color: #EEF4F1;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            gap: 1rem;
        }

        .nav-btn {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            color: white;
            border: none;
            padding: 0.9rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .nav-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #5a6268 0%, #4e555b 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, #00843D 0%, #005921 100%);
        }

        .nav-btn.primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #005921 0%, #004a1e 100%);
            box-shadow: 0 5px 15px rgba(0, 89, 33, 0.4);
        }

        .nav-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        #results {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .ministry-list {
            margin: 2rem 0;
        }

        .ministry-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            margin: 1rem 0;
            padding: 1.5rem;
            border-radius: 15px;
            border-left: 5px solid #00843D;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .ministry-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            border-left-color: #005921;
        }

        .ministry-item h3 {
            margin-top: 0;
            margin-bottom: 0.8rem;
            color: #2c3e50;
            font-size: 1.2rem;
            font-weight: 600;
            line-height: 1.3;
        }

        .ministry-item p {
            margin: 0.6rem 0;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .ministry-item .details {
            color: #00843D;
            font-weight: 600;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .ministry-item .details a {
            color: #005921;
            text-decoration: none;
            border-bottom: 1px solid #005921;
        }

        .ministry-item .details a:hover {
            color: #004a1e;
            border-bottom-color: #004a1e;
        }

        .contact-info a {
            color: #005921;
            text-decoration: none;
        }

        .contact-info a:hover {
            text-decoration: underline;
        }

        .parish-registration {
            background: linear-gradient(135deg, #f0f8f4 0%, #e8f5e8 100%);
            padding: 1.5rem;
            border-radius: 15px;
            margin: 2rem 0;
            border: 2px solid rgba(0, 132, 61, 0.2);
            text-align: center;
        }

        .parish-registration h3 {
            color: #005921;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .parish-registration p {
            margin-bottom: 1.5rem;
            color: #2c3e50;
            line-height: 1.5;
        }

        .registration-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .registration-btn {
            background: linear-gradient(135deg, #00843D 0%, #005921 100%);
            color: #EEF4F1;
            text-decoration: none;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .registration-btn:hover {
            background: linear-gradient(135deg, #005921 0%, #004a1e 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 89, 33, 0.4);
            color: #EEF4F1;
            text-decoration: none;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-links a {
            color: #005921;
            text-decoration: none;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            border: 1px solid #005921;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .social-links a:hover {
            background: #005921;
            color: white;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 1rem;
            color: #005921;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 89, 33, 0.3);
            border-radius: 50%;
            border-top-color: #005921;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .message {
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            border-left: 4px solid;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .message.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #005921;
            color: #155724;
        }

        .message.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-color: #dc3545;
            color: #721c24;
        }

        .contact-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            margin: 2rem 0;
            border: 2px solid rgba(0, 89, 33, 0.1);
        }

        .contact-info h4 {
            color: #005921;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .contact-info p {
            margin: 0.5rem 0;
            color: #495057;
            font-size: 0.95rem;
        }

        .restart-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 0.9rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 2rem;
        }

        .restart-btn:hover {
            background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
        }

        .note {
            background: rgba(0, 89, 33, 0.05);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.85rem;
            color: #495057;
            border-left: 3px solid #005921;
        }

        /* Enhanced Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                margin: 1rem auto;
                padding: 0 0.75rem;
            }
            
            .logo-text {
                font-size: 1.6rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .theme-verse {
                font-size: 0.8rem;
            }
            
            .card-header {
                padding: 1.5rem 1rem;
            }
            
            .card-header h1 {
                font-size: 1.5rem;
            }
            
            .card-header p {
                font-size: 0.95rem;
            }
            
            .card-content {
                padding: 1.5rem 1rem;
            }
            
            .question h2 {
                font-size: 1.2rem;
                margin-bottom: 1rem;
            }
            
            .button-group {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .option-btn {
                padding: 0.9rem 1rem;
                font-size: 0.9rem;
            }
            
            .navigation {
                flex-direction: column;
            }
            
            .nav-btn {
                padding: 0.8rem 1.2rem;
                font-size: 0.9rem;
            }
            
            .ministry-item {
                padding: 1.2rem;
            }
            
            .ministry-item h3 {
                font-size: 1.1rem;
            }
            
            .parish-registration {
                padding: 1.2rem;
            }
            
            .contact-info {
                padding: 1.2rem;
            }

            .registration-buttons {
                grid-template-columns: 1fr;
            }

            .social-links {
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 0.5rem;
            }
            
            .header-content {
                padding: 0 0.5rem;
            }
            
            .logo-text {
                font-size: 1.4rem;
            }
            
            .card-header h1 {
                font-size: 1.3rem;
            }
            
            .question h2 {
                font-size: 1.1rem;
            }
            
            .option-btn {
                padding: 0.8rem;
                font-size: 0.85rem;
            }
            
            .checkbox-item {
                padding: 0.8rem;
                gap: 0.6rem;
            }
            
            .ministry-item {
                padding: 1rem;
            }
        }

        /* Touch-friendly targets for mobile */
        @media (max-width: 768px) {
            .option-btn, .nav-btn, .registration-btn, .checkbox-item {
                min-height: 44px; /* Apple's recommended touch target size */
            }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 89, 33, 0.95);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .loading-subtext {
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.8;
            max-width: 400px;
            line-height: 1.4;
        }

        /* Confetti Animation */
        .confetti {
            position: fixed;
            top: -10px;
            z-index: 1000;
            pointer-events: none;
            width: 10px;
            height: 10px;
            animation: confetti-fall 3s linear forwards;
        }

        .confetti-1 { background-color: #005921; }
        .confetti-2 { background-color: #00843D; }
        .confetti-3 { background-color: #FFD700; }
        .confetti-4 { background-color: #FF6B6B; }
        .confetti-5 { background-color: #4ECDC4; }
        .confetti-6 { background-color: #45B7D1; }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading St. Edward Ministry Finder...</div>
        <div class="loading-subtext">
            If this is taking a while, our service might be starting up. 
            Thank you for your patience! ‚õ™
        </div>
    </div>
    
    <header class="header">
        <div class="header-content">
            <div class="logo-text">‚õ™ St. Edward Church & School</div>
            <div class="subtitle">Find Your Place in Our Community</div>
            <div class="theme-verse">"Through Love, Serve One Another" - Galatians 5:13</div>
        </div>
    </header>

    <div class="container">
        <div class="main-card">
            <div class="card-header">
                <h1>Stepping into St. Edward Church</h1>
                <p>Discover what St. Edward has to offer that matches your interests and life situation</p>
            </div>

            <div class="card-content">
                <div class="progress">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                
                <!-- Question 1: Age -->
                <div class="question active" id="q1">
                    <h2>Choose what best describes you:</h2>
                    <div class="button-group">
                        <button class="option-btn" onclick="answerQuestion('age', 'infant')">Infant (0-3)</button>
                        <button class="option-btn" onclick="answerQuestion('age', 'kid')">Kid (PreK-Grade 5)</button>
                        <button class="option-btn" onclick="answerQuestion('age', 'junior-high')">Junior High (Grades 6-8)</button>
                        <button class="option-btn" onclick="answerQuestion('age', 'high-school')">High School (Grades 9-12)</button>
                        <button class="option-btn" onclick="answerQuestion('age', 'college-young-adult')">College & Young Adult (18-35)</button>
                        <button class="option-btn" onclick="answerQuestion('age', 'married-parents')">Married Couples & Parents</button>
                        <button class="option-btn" onclick="answerQuestion('age', 'journeying-adults')">Journeying Adults (30+)</button>
                    </div>
                </div>

                <!-- Question 2: Gender -->
                <div class="question" id="q2">
                    <h2>Are you:</h2>
                    <div class="button-group">
                        <button class="option-btn" onclick="answerQuestion('gender', 'male')">Male</button>
                        <button class="option-btn" onclick="answerQuestion('gender', 'female')">Female</button>
                        <button class="option-btn" onclick="answerQuestion('gender', 'skip')">Skip this question</button>
                    </div>
                    <div class="navigation">
                        <button class="nav-btn" onclick="goBack(2)">‚Üê Back</button>
                        <div></div>
                    </div>
                </div>

                <!-- Question 3: State in Life -->
                <div class="question" id="q3">
                    <h2>What's your state in life?</h2>
                    <div class="button-group">
                        <button class="option-btn" onclick="answerQuestion('state', 'single')">Single</button>
                        <button class="option-btn" onclick="answerQuestion('state', 'married')">Married</button>
                        <button class="option-btn" onclick="answerQuestion('state', 'parent')">Parent</button>
                        <button class="option-btn" onclick="answerQuestion('state', 'skip')">Skip this question</button>
                    </div>
                    <div class="navigation">
                        <button class="nav-btn" onclick="goBack(3)">‚Üê Back</button>
                        <div></div>
                    </div>
                </div>

                <!-- Question 4: Situation -->
                <div class="question" id="q4">
                    <h2>What describes your situation?</h2>
                    <p style="margin-bottom: 1rem; color: #666;">Select all that apply:</p>
                    <div class="checkbox-group" id="situation-checkboxes">
                        <div class="checkbox-item" onclick="toggleSituationCheckbox('new-to-stedward')">
                            <input type="checkbox" id="new-to-stedward" value="new-to-stedward" onchange="handleCheckboxChange('new-to-stedward')">
                            <label for="new-to-stedward">New to St. Edward</label>
                        </div>
                        <div class="checkbox-item" onclick="toggleSituationCheckbox('returning-to-church')">
                            <input type="checkbox" id="returning-to-church" value="returning-to-church" onchange="handleCheckboxChange('returning-to-church')">
                            <label for="returning-to-church">Returning to Church</label>
                        </div>
                        <div class="checkbox-item" onclick="toggleSituationCheckbox('new-to-nashville')">
                            <input type="checkbox" id="new-to-nashville" value="new-to-nashville" onchange="handleCheckboxChange('new-to-nashville')">
                            <label for="new-to-nashville">New to Nashville</label>
                        </div>
                        <div class="checkbox-item" onclick="toggleSituationCheckbox('current-parishioner')">
                            <input type="checkbox" id="current-parishioner" value="current-parishioner" onchange="handleCheckboxChange('current-parishioner')">
                            <label for="current-parishioner">Current Parishioner</label>
                        </div>
                        <div class="checkbox-item" onclick="toggleSituationCheckbox('just-curious')">
                            <input type="checkbox" id="just-curious" value="just-curious" onchange="handleCheckboxChange('just-curious')">
                            <label for="just-curious">Just Curious</label>
                        </div>
                        <div class="checkbox-item" onclick="toggleSituationCheckbox('none-of-above')">
                            <input type="checkbox" id="none-of-above" value="none-of-above" onchange="handleCheckboxChange('none-of-above')">
                            <label for="none-of-above">None of the above</label>
                        </div>
                    </div>
                    <div class="navigation">
                        <button class="nav-btn" onclick="goBack(4)">‚Üê Back</button>
                        <button class="nav-btn primary" onclick="nextFromSituation()">Continue ‚Üí</button>
                    </div>
                </div>

                <!-- Question 5: Interests -->
                <div class="question" id="q5">
                    <h2>What interests you most?</h2>
                    <p style="margin-bottom: 1rem; color: #666;">Select all that apply:</p>
                    <div class="checkbox-group" id="interest-checkboxes">
                        <!-- Filled dynamically based on age -->
                    </div>
                    <div class="navigation">
                        <button class="nav-btn" onclick="goBack(5)">‚Üê Back</button>
                        <button class="nav-btn primary" onclick="showResults()">See My Results ‚Üí</button>
                    </div>
                </div>

                <!-- Results -->
                <div id="results">
                    <h2>Here's what might be a good fit for you:</h2>
                    <div class="note">
                        üí° <strong>Tip:</strong> You can screenshot your results for future reference!
                    </div>
                    <div id="ministry-recommendations" class="ministry-list"></div>
                    
                    <div class="parish-registration">
                        <h3>üéâ Ready to Get Connected?</h3>
                        <p>Join our parish community and stay updated on all these great opportunities!</p>
                        
                        <div class="registration-buttons">
                            <a href="https://stedwardnash.flocknote.com/register" target="_blank" class="registration-btn">
                                üìß Register with Parish
                            </a>
                        </div>
                        
                        <div class="social-links">
                            <a href="https://stedward.smugmug.com/" target="_blank">üì∏ Parish Photos</a>
                            <a href="https://www.instagram.com/stedwardcommunity/" target="_blank">üì± Instagram</a>
                            <a href="https://www.facebook.com/stedwardschool" target="_blank">üë• Facebook</a>
                        </div>
                    </div>
                    
                    <div class="contact-info">
                        <h4>Questions?</h4>
                        <p><strong>Call:</strong> (615) 833-5520</p>
                        <p><strong>Email:</strong> <a href="mailto:support@stedward.org">support@stedward.org</a></p>
                        <p><strong>Visit:</strong> <a href="https://stedward.org" target="_blank">stedward.org</a></p>
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="restart-btn" onclick="restart()">üîÑ Start Over</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Store user answers
        const answers = {};
        const situation = [];
        const interests = []; // New array for multiple interests
        let currentQuestion = 1;
        const totalQuestions = 5;

        // Age-specific interest options
        const interestOptions = {
            infant: [
                { value: 'support', label: 'Parent Support & Community' },
                { value: 'education', label: 'Learning About Faith' },
                { value: 'service', label: 'Helping Others' },
                { value: 'all', label: 'Show me everything!' }
            ],
            kid: [
                { value: 'education', label: 'Learning & Growing in Faith' },
                { value: 'fellowship', label: 'Making Friends' },
                { value: 'music', label: 'Music & Arts' },
                { value: 'service', label: 'Helping Others' },
                { value: 'all', label: 'Show me everything!' }
            ],
            'junior-high': [
                { value: 'fellowship', label: 'Fellowship & Community' },
                { value: 'education', label: 'Learning & Teaching' },
                { value: 'service', label: 'Serving Others' },
                { value: 'prayer', label: 'Prayer & Worship' },
                { value: 'all', label: 'Show me everything!' }
            ],
            'high-school': [
                { value: 'fellowship', label: 'Fellowship & Community' },
                { value: 'service', label: 'Serving Others' },
                { value: 'prayer', label: 'Prayer & Worship' },
                { value: 'music', label: 'Music & Arts' },
                { value: 'education', label: 'Learning & Teaching' },
                { value: 'all', label: 'Show me everything!' }
            ],
            'college-young-adult': [
                { value: 'fellowship', label: 'Fellowship & Community' },
                { value: 'service', label: 'Serving Others' },
                { value: 'prayer', label: 'Prayer & Worship' },
                { value: 'education', label: 'Learning & Teaching' },
                { value: 'music', label: 'Music & Arts' },
                { value: 'all', label: 'Show me everything!' }
            ],
            'married-parents': [
                { value: 'fellowship', label: 'Fellowship & Community' },
                { value: 'service', label: 'Serving Others' },
                { value: 'education', label: 'Learning & Teaching' },
                { value: 'prayer', label: 'Prayer & Worship' },
                { value: 'support', label: 'Family Support' },
                { value: 'all', label: 'Show me everything!' }
            ],
            'journeying-adults': [
                { value: 'prayer', label: 'Prayer & Worship' },
                { value: 'service', label: 'Serving Others' },
                { value: 'fellowship', label: 'Fellowship & Community' },
                { value: 'education', label: 'Learning & Teaching' },
                { value: 'music', label: 'Music & Arts' },
                { value: 'all', label: 'Show me everything!' }
            ]
        };

        // Ministry database with updated mappings
        const ministries = {
            // Sacraments
            'ocia': {
                name: 'OCIA (Adult Baptism/Full Communion)',
                description: 'Program that prepares adults for Baptism, Holy Communion & Confirmation',
                details: 'Visit <a href="https://stedward.org/ocia" target="_blank">stedward.org/ocia</a> for more information',
                age: ['college-young-adult', 'married-parents', 'journeying-adults'],
                interest: ['education', 'prayer']
            },
            'infant-baptism': {
                name: 'Infant Baptism (0-5 yrs)',
                description: 'Baptism preparation for families with young children',
                details: 'Visit <a href="https://stedward.org/baptism" target="_blank">stedward.org/baptism</a> to register',
                age: ['infant'],
                interest: ['education', 'prayer', 'all']
            },
            'marriage-convalidation': {
                name: 'Marriage Convalidation',
                description: 'Sacrament of Holy Matrimony for civilly married couples',
                details: 'Fill out intake form at <a href="https://stedward.org/marriage-prep" target="_blank">stedward.org/marriage-prep</a>',
                age: ['college-young-adult', 'married-parents'],
                state: ['married'],
                interest: ['education', 'prayer']
            },
            
            // Parent Support
            'moms-group': {
                name: 'Moms Group',
                description: 'Spiritual & practical support for mothers with rosary walks and monthly brunch',
                details: 'Join on Flocknote: <a href="https://stedwardnash.flocknote.com/signup/180620" target="_blank">stedwardnash.flocknote.com/signup/180620</a><br>Or join GroupMe: <a href="https://groupme.com/join_group/107457911/mdAevstX" target="_blank">groupme.com/join_group/107457911/mdAevstX</a>',
                age: ['infant', 'married-parents'],
                gender: ['female'],
                state: ['parent'],
                interest: ['fellowship', 'support', 'prayer']
            },
            // Meal Train - Recipients (for new families)
            'meal-train-receive': {
                name: 'Meal Train Support for Your Family',
                description: 'We want to serve you and support you with our meal train for families with new members!',
                details: 'Contact <a href="mailto:elizabethlansden@gmail.com">elizabethlansden@gmail.com</a> if your family is growing soon and would like to receive meals.',
                age: ['infant'],
                interest: ['support', 'fellowship', 'all']
            },
            
            // Meal Train - Providers (for those who can help)
            'meal-train-provide': {
                name: 'Meal Train for New Families',
                description: 'Support growing families with meal delivery when they welcome a baby, adopt, or receive a foster child',
                details: 'Flexible commitment - participate 1-3 times per year. Contact <a href="mailto:elizabethlansden@gmail.com">elizabethlansden@gmail.com</a> to join the volunteer list.',
                age: ['married-parents', 'college-young-adult', 'journeying-adults'],
                interest: ['service', 'fellowship', 'support']
            },
            
            // Kids
            'st-edward-school': {
                name: 'St. Edward School (PreK-8th Grade)',
                description: 'Catholic education in a faith-filled community environment',
                details: 'Apply for enrollment: <a href="https://ses.stedward.org/apply" target="_blank">ses.stedward.org/apply</a>',
                age: ['kid'],
                interest: ['education', 'fellowship', 'all']
            },
            'cub-scouts': {
                name: 'Cub Scouts',
                description: 'Character development and outdoor adventures for boys and girls',
                details: 'Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for more information',
                age: ['kid'],
                interest: ['fellowship', 'service', 'all']
            },
            'catechesis': {
                name: 'Catechesis of the Good Shepherd Atrium',
                description: 'Montessori-based religious education for Pre-K-2',
                details: 'Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for enrollment',
                age: ['kid'],
                interest: ['education', 'prayer']
            },
            'prep-kids': {
                name: 'PREP - Sunday Religious Ed',
                description: 'Including First Confession & First Holy Communion prep',
                details: 'Visit <a href="https://stedward.org/prep" target="_blank">stedward.org/prep</a> to register',
                age: ['kid'],
                interest: ['education', 'prayer']
            },
            'totus-tuus-kids': {
                name: 'Totus Tuus Summer Program (Grades 1-6)',
                description: 'Week-long summer catechetical program with games and activities',
                details: 'Visit <a href="https://stedward.org/totus-tuus" target="_blank">stedward.org/totus-tuus</a> - registration opens in spring',
                age: ['kid'],
                interest: ['education', 'fellowship', 'prayer']
            },
            
            // Junior High
            'prep-jr': {
                name: 'PREP - Sacrament Prep & Faith Formation',
                description: 'Religious education and sacrament preparation',
                details: 'Visit <a href="https://stedward.org/prep" target="_blank">stedward.org/prep</a> to register',
                age: ['junior-high'],
                interest: ['education', 'prayer']
            },
            'fraternus-jr': {
                name: 'Fraternus',
                description: 'Brotherhood & virtue formation for boys - developing Catholic men through weekly meetings and excursions',
                details: 'Wednesdays 6:00-8:00pm. Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for information',
                age: ['junior-high'],
                gender: ['male'],
                interest: ['fellowship', 'education']
            },
            'fidelis-jr': {
                name: 'Fidelis',
                description: 'Sisterhood & virtue for girls - faith-filled friendships through discussion, activities, and fun',
                details: 'Bi-weekly Wednesdays 6:30-8:30pm. Contact <a href="mailto:fidelisnashville@gmail.com">fidelisnashville@gmail.com</a>',
                age: ['junior-high'],
                gender: ['female'],
                interest: ['fellowship', 'education']
            },
            'totus-tuus-jr': {
                name: 'Totus Tuus Summer Program',
                description: 'Summer catechetical program with peer ministry opportunities',
                details: 'Visit <a href="https://stedward.org/totus-tuus" target="_blank">stedward.org/totus-tuus</a> - registration opens in spring',
                age: ['junior-high'],
                interest: ['education', 'fellowship', 'prayer']
            },
            
            // High School
            'fraternus-hs': {
                name: 'Fraternus',
                description: 'Weekly formation, excursions, and retreats developing virtuous Catholic men',
                details: 'Wednesdays 6:00-8:00pm with 4 weekend excursions. Contact <a href="mailto:support@stedward.org">support@stedward.org</a>',
                age: ['high-school'],
                gender: ['male'],
                interest: ['fellowship', 'education']
            },
            'fidelis-hs': {
                name: 'Fidelis',
                description: 'Weekly formation, excursions, and retreats for young women in faith',
                details: 'Bi-weekly Wednesdays 6:30-8:30pm. Contact <a href="mailto:fidelisnashville@gmail.com">fidelisnashville@gmail.com</a>',
                age: ['high-school'],
                gender: ['female'],
                interest: ['fellowship', 'education']
            },
            'liturgical-hs': {
                name: 'Liturgical Ministries (Age 16+)',
                description: 'Serve as lector, hospitality, or EMHC',
                details: 'Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for training',
                age: ['high-school'],
                interest: ['service', 'prayer']
            },
            'choir-hs': {
                name: 'Sacred Music / Choir (Age 16+)',
                description: 'Weekly rehearsal & Mass service',
                details: 'Fill out form: <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=spbPjOu3C0enFewWltg-vSGAojmE4WpCvxL72BS8279UN0RYT042M0dDNlNLQ0ZTSDlFQ1ZWMTdKWC4u" target="_blank">Sacred Music Interest Form</a><br>Or contact <a href="mailto:nrankin@stedward.org">nrankin@stedward.org</a>',
                age: ['high-school'],
                interest: ['music', 'prayer']
            },
            'totus-tuus-hs': {
                name: 'Totus Tuus Summer Program',
                description: 'Apologetics & fellowship for high schoolers with leadership opportunities',
                details: 'Visit <a href="https://stedward.org/totus-tuus" target="_blank">stedward.org/totus-tuus</a> - registration opens in spring',
                age: ['high-school'],
                interest: ['education', 'fellowship', 'prayer']
            },
            
            // College & Young Adult
            'theology-tap': {
                name: 'Theology on Tap (Summer Series)',
                description: 'Faith & fellowship in beer-garden setting with engaging speakers',
                details: 'Visit <a href="https://stedward.org/theo-on-tap" target="_blank">stedward.org/theo-on-tap</a> - check bulletin for dates',
                age: ['college-young-adult'],
                interest: ['fellowship', 'education']
            },
            'totus-tuus-missionary': {
                name: 'Totus Tuus Missionary Teams',
                description: 'Summer evangelization work teaching children and teens',
                details: 'Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for application',
                age: ['college-young-adult'],
                interest: ['service', 'education', 'prayer']
            },
            'fraternus-mentors': {
                name: 'Fraternus Adult Mentors',
                description: 'College men serve younger boys (Wednesday evenings)',
                details: 'Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for information',
                age: ['college-young-adult'],
                gender: ['male'],
                interest: ['service', 'fellowship']
            },
            'ocia-sponsors': {
                name: 'OCIA Sponsors',
                description: 'Accompany adults entering the Church',
                details: 'Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for information',
                age: ['college-young-adult'],
                interest: ['service', 'education']
            },
            'room-inn-ya': {
                name: 'Room-in-the-Inn Shelter Crew',
                description: 'Saturday-night hospitality for homeless men during winter months',
                details: 'Contact Greg Beem at <a href="mailto:support@stedward.org">support@stedward.org</a>',
                age: ['college-young-adult'],
                interest: ['service']
            },
            'cursillo': {
                name: 'Cursillo Retreats',
                description: 'Three-day renewal weekends focused on spiritual growth',
                details: 'Visit <a href="https://stedward.org/cursillo" target="_blank">stedward.org/cursillo</a> for information',
                age: ['college-young-adult'],
                interest: ['prayer', 'fellowship']
            },
            'choir-ya': {
                name: 'Sacred Music / Choir',
                description: 'Weekly rehearsal & Mass service',
                details: 'Fill out form: <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=spbPjOu3C0enFewWltg-vSGAojmE4WpCvxL72BS8279UN0RYT042M0dDNlNLQ0ZTSDlFQ1ZWMTdKWC4u" target="_blank">Sacred Music Interest Form</a><br>Or contact <a href="mailto:nrankin@stedward.org">nrankin@stedward.org</a>',
                age: ['college-young-adult'],
                interest: ['music', 'prayer']
            },
            'knights-ya': {
                name: 'Knights of Columbus',
                description: 'Catholic men\'s fraternal organization focused on charity, unity, fraternity, and patriotism',
                details: 'Visit <a href="https://stedward.org/kofc" target="_blank">stedward.org/kofc</a> for more information',
                age: ['college-young-adult'],
                gender: ['male'],
                interest: ['fellowship', 'service', 'prayer']
            },
            'ladies-aux-ya': {
                name: 'Ladies Auxiliary',
                description: 'Prayer, service, fellowship for women',
                details: 'Visit <a href="https://stedward.org/ladies-auxiliary" target="_blank">stedward.org/ladies-auxiliary</a> for information',
                age: ['college-young-adult'],
                gender: ['female'],
                interest: ['fellowship', 'service', 'prayer']
            },
            
            // Spouses and Parents
            'marriage-enrichment': {
                name: 'Marriage Enrichment Nights',
                description: 'Strengthen your marriage through faith',
                details: 'Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for schedule',
                age: ['married-parents'],
                state: ['married'],
                interest: ['fellowship', 'education', 'support']
            },
            'knights-parents': {
                name: 'Knights of Columbus',
                description: 'Men\'s service fraternity with monthly Cor Nights and insurance benefits',
                details: 'Visit <a href="https://stedward.org/kofc" target="_blank">stedward.org/kofc</a> for information',
                age: ['married-parents'],
                gender: ['male'],
                interest: ['fellowship', 'service']
            },
            'ladies-aux-parents': {
                name: 'Ladies Auxiliary',
                description: 'Service, crafts, Angel-Tree outreach',
                details: 'Visit <a href="https://stedward.org/ladies-auxiliary" target="_blank">stedward.org/ladies-auxiliary</a> for information',
                age: ['married-parents'],
                gender: ['female'],
                interest: ['fellowship', 'service']
            },
            'coffee-donuts-parents': {
                name: 'Coffee-&-Donuts Hospitality Team',
                description: 'Once a month after-Mass fellowship in Little Carrel Room',
                details: 'Visit <a href="https://stedward.org/coffee-donuts" target="_blank">stedward.org/coffee-donuts</a> to volunteer',
                age: ['married-parents'],
                interest: ['fellowship', 'service']
            },
            'bereavement-parents': {
                name: 'Bereavement Meal Ministry',
                description: 'Cook/serve funeral-day luncheons',
                details: 'Visit <a href="https://stedward.org/bereavement" target="_blank">stedward.org/bereavement</a> to participate',
                age: ['married-parents'],
                interest: ['service']
            },
            'svdp-parents': {
                name: 'St. Vincent de Paul Society',
                description: 'Support for neighbors in need - meet first Sunday monthly',
                details: 'Call Rick Prickett (615) 283-0374 or visit <a href="https://stedward.org/st-vincent-de-paul" target="_blank">stedward.org/st-vincent-de-paul</a>',
                age: ['married-parents'],
                interest: ['service']
            },
            
            // Journeying Adults
            'svdp-adults': {
                name: 'St. Vincent de Paul Society',
                description: 'Helping neighbors in need - meet first Sunday monthly in Scout Room',
                details: 'Call Rick Prickett (615) 283-0374 or visit <a href="https://stedward.org/st-vincent-de-paul" target="_blank">stedward.org/st-vincent-de-paul</a>',
                age: ['journeying-adults'],
                interest: ['service']
            },
            'hospitality-ministry': {
                name: 'Hospitality Ministry',
                description: 'Welcome and serve parish community',
                details: 'Visit <a href="https://stedward.org/hospitality-ministry" target="_blank">stedward.org/hospitality-ministry</a> for information',
                age: ['journeying-adults'],
                interest: ['fellowship', 'service']
            },
            'coffee-donuts-adults': {
                name: 'Coffee-&-Donuts',
                description: 'Once a month after-Mass fellowship in Little Carrel Room',
                details: 'Visit <a href="https://stedward.org/coffee-donuts" target="_blank">stedward.org/coffee-donuts</a> to volunteer',
                age: ['journeying-adults'],
                interest: ['fellowship', 'service']
            },
            'bereavement-adults': {
                name: 'Bereavement Meal Ministry',
                description: 'Support families during difficult times by cooking and serving funeral luncheons',
                details: 'Visit <a href="https://stedward.org/bereavement" target="_blank">stedward.org/bereavement</a> to participate',
                age: ['journeying-adults'],
                interest: ['service']
            },
            'adoration-guild': {
                name: 'Adoration Guild',
                description: 'Committed prayer before the Blessed Sacrament',
                details: 'Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for information',
                age: ['journeying-adults'],
                interest: ['prayer']
            },
            'knights-adults': {
                name: 'Knights of Columbus',
                description: 'Catholic men\'s fraternal organization with insurance and financial planning benefits',
                details: 'Visit <a href="https://stedward.org/kofc" target="_blank">stedward.org/kofc</a> to become a St. Edward Knight',
                age: ['journeying-adults'],
                gender: ['male'],
                interest: ['fellowship', 'service']
            },
            'ladies-aux-adults': {
                name: 'Ladies Auxiliary',
                description: 'Women\'s fellowship and service',
                details: 'Visit <a href="https://stedward.org/ladies-auxiliary" target="_blank">stedward.org/ladies-auxiliary</a> for information',
                age: ['journeying-adults'],
                gender: ['female'],
                interest: ['fellowship', 'service']
            },
            'catechists': {
                name: 'Catechists',
                description: 'Teach faith formation classes',
                details: 'Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for information',
                age: ['journeying-adults'],
                interest: ['education', 'service']
            },
            'choir-adults': {
                name: 'Sacred Music / Choir',
                description: 'Weekly rehearsal & Mass service',
                details: 'Fill out form: <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=spbPjOu3C0enFewWltg-vSGAojmE4WpCvxL72BS8279UN0RYT042M0dDNlNLQ0ZTSDlFQ1ZWMTdKWC4u" target="_blank">Sacred Music Interest Form</a><br>Or contact <a href="mailto:nrankin@stedward.org">nrankin@stedward.org</a>',
                age: ['journeying-adults'],
                interest: ['music', 'prayer']
            },
            'liturgical-adults': {
                name: 'Serving at Mass',
                description: 'Lector, EMHC, Usher',
                details: 'Visit <a href="https://stedward.org/liturgical" target="_blank">stedward.org/liturgical</a> for training',
                age: ['journeying-adults'],
                interest: ['prayer', 'service']
            },
            'room-inn-adults': {
                name: 'Room In The Inn',
                description: 'Service & hospitality for homeless men during winter months',
                details: 'Visit <a href="https://stedward.org/room-in-the-inn" target="_blank">stedward.org/room-in-the-inn</a> or contact Greg Beem',
                age: ['journeying-adults'],
                interest: ['service']
            },
            'haiti-sister-parish': {
                name: 'Haiti Sister Parish Support',
                description: 'Support our sister parish in Haiti',
                details: 'Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for information',
                age: ['journeying-adults'],
                interest: ['service']
            },
            'bible-bunco': {
                name: 'Bible Bunco & Blessings',
                description: 'Faith and fellowship through games',
                details: 'Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for information',
                age: ['journeying-adults'],
                gender: ['female'],
                interest: ['fellowship', 'education']
            },
            
            // Always Available
            'mass': {
                name: 'Daily & Sunday Mass',
                description: 'The source and summit of our faith',
                details: 'Mass times available at <a href="https://stedward.org" target="_blank">stedward.org</a>',
                age: ['infant', 'kid', 'junior-high', 'high-school', 'college-young-adult', 'married-parents', 'journeying-adults'],
                interest: ['prayer', 'all']
            },
            'returning-catholic': {
                name: 'If It\'s Been A While...',
                description: 'Gentle return to the Catholic Church',
                details: 'Call (615) 833-5520 or email <a href="mailto:support@stedward.org">support@stedward.org</a>',
                age: ['college-young-adult', 'married-parents', 'journeying-adults'],
                interest: ['prayer', 'education', 'all'],
                situation: ['returning-to-church']
            },
            'welcome-committee': {
                name: 'Welcome to St. Edward!',
                description: 'New parishioner orientation and support',
                details: 'Register online: <a href="https://stedwardnash.flocknote.com/register" target="_blank">stedwardnash.flocknote.com/register</a><br>Follow us: <a href="https://www.instagram.com/stedwardcommunity/" target="_blank">Instagram</a> | <a href="https://www.facebook.com/stedwardschool" target="_blank">Facebook</a><br>Photo galleries: <a href="https://stedward.smugmug.com/" target="_blank">stedward.smugmug.com</a>',
                age: ['college-young-adult', 'married-parents', 'journeying-adults'],
                interest: ['fellowship', 'all'],
                situation: ['new-to-stedward']
            },
            'nashville-newcomers': {
                name: 'Nashville Newcomers Group',
                description: 'Connect with other families new to Nashville',
                details: 'Contact <a href="mailto:support@stedward.org">support@stedward.org</a> for information',
                age: ['college-young-adult', 'married-parents', 'journeying-adults'],
                interest: ['fellowship', 'all'],
                situation: ['new-to-nashville']
            }
        };

        function answerQuestion(type, answer) {
            answers[type] = answer;
            
            // Update button styling
            const buttons = document.querySelectorAll(`#q${currentQuestion} .option-btn`);
            buttons.forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            
            // Wait a moment for visual feedback
            setTimeout(() => {
                // For younger age groups, skip state in life question
                if (type === 'age' && ['infant', 'kid', 'junior-high', 'high-school'].includes(answer)) {
                    answers['state'] = 'single'; // Auto-assign single for younger ages
                }
                
                currentQuestion++;
                
                // Skip question 3 (state in life) for younger age groups
                if (currentQuestion === 3 && answers.age && ['infant', 'kid', 'junior-high', 'high-school'].includes(answers.age)) {
                    currentQuestion = 4; // Jump to situation question
                }
                
                // For interest question, populate age-specific options
                if (currentQuestion === 5) {
                    populateInterestOptions();
                }
                
                updateProgress();
                showQuestion(currentQuestion);
            }, 300);
        }

        function toggleSituationCheckbox(value) {
            // Only handle if click came from the container, not the checkbox or label
            if (event.target.type === 'checkbox' || event.target.tagName === 'LABEL') {
                return; // Let the native behavior handle it
            }
            
            const checkbox = document.getElementById(value);
            checkbox.checked = !checkbox.checked;
            
            // Trigger the change handler
            handleCheckboxChange(value);
        }

        function handleCheckboxChange(value) {
            const checkbox = document.getElementById(value);
            const item = checkbox.parentElement;
            
            // Handle "none of above" logic
            if (value === 'none-of-above') {
                if (checkbox.checked) {
                    // Clear all other checkboxes
                    document.querySelectorAll('#situation-checkboxes input[type="checkbox"]').forEach(cb => {
                        if (cb.id !== 'none-of-above') {
                            cb.checked = false;
                            cb.parentElement.classList.remove('selected');
                        }
                    });
                    situation.length = 0; // Clear array
                    situation.push('none-of-above');
                }
            } else {
                // If selecting something else, uncheck "none of above"
                const noneCheckbox = document.getElementById('none-of-above');
                if (noneCheckbox && noneCheckbox.checked) {
                    noneCheckbox.checked = false;
                    noneCheckbox.parentElement.classList.remove('selected');
                    const noneIndex = situation.indexOf('none-of-above');
                    if (noneIndex > -1) situation.splice(noneIndex, 1);
                }
            }
            
            // Update the situation array and styling
            if (checkbox.checked) {
                item.classList.add('selected');
                if (!situation.includes(value)) {
                    situation.push(value);
                }
            } else {
                item.classList.remove('selected');
                const index = situation.indexOf(value);
                if (index > -1) {
                    situation.splice(index, 1);
                }
            }
        }

        function nextFromSituation() {
            currentQuestion++;
            populateInterestOptions();
            updateProgress();
            showQuestion(currentQuestion);
        }

        function populateInterestOptions() {
            const interestContainer = document.getElementById('interest-checkboxes');
            const ageGroup = answers.age;
            const options = interestOptions[ageGroup] || interestOptions['journeying-adults'];
            
            interestContainer.innerHTML = '';
            options.forEach(option => {
                const checkboxDiv = document.createElement('div');
                checkboxDiv.className = 'checkbox-item';
                checkboxDiv.onclick = () => toggleInterestCheckbox(option.value);
                
                checkboxDiv.innerHTML = `
                    <input type="checkbox" id="interest-${option.value}" value="${option.value}" onchange="handleInterestCheckboxChange('${option.value}')">
                    <label for="interest-${option.value}">${option.label}</label>
                `;
                
                interestContainer.appendChild(checkboxDiv);
            });
        }

        function toggleInterestCheckbox(value) {
            // Only handle if click came from the container, not the checkbox or label
            if (event.target.type === 'checkbox' || event.target.tagName === 'LABEL') {
                return; // Let the native behavior handle it
            }
            
            const checkbox = document.getElementById(`interest-${value}`);
            checkbox.checked = !checkbox.checked;
            
            // Trigger the change handler
            handleInterestCheckboxChange(value);
        }

        function handleInterestCheckboxChange(value) {
            const checkbox = document.getElementById(`interest-${value}`);
            const item = checkbox.parentElement;
            
            // Handle "show me everything" logic
            if (value === 'all') {
                if (checkbox.checked) {
                    // Clear all other checkboxes and select only "all"
                    document.querySelectorAll('#interest-checkboxes input[type="checkbox"]').forEach(cb => {
                        if (cb.value !== 'all') {
                            cb.checked = false;
                            cb.parentElement.classList.remove('selected');
                        }
                    });
                    interests.length = 0; // Clear array
                    interests.push('all');
                }
            } else {
                // If selecting something else, uncheck "show me everything"
                const allCheckbox = document.getElementById('interest-all');
                if (allCheckbox && allCheckbox.checked) {
                    allCheckbox.checked = false;
                    allCheckbox.parentElement.classList.remove('selected');
                    const allIndex = interests.indexOf('all');
                    if (allIndex > -1) interests.splice(allIndex, 1);
                }
            }
            
            // Update the interests array and styling
            if (checkbox.checked) {
                item.classList.add('selected');
                if (!interests.includes(value)) {
                    interests.push(value);
                }
            } else {
                item.classList.remove('selected');
                const index = interests.indexOf(value);
                if (index > -1) {
                    interests.splice(index, 1);
                }
            }
        }

        function goBack(questionNum) {
            // Clear selected styling
            document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.checkbox-item').forEach(item => item.classList.remove('selected'));
            
            // Clear checkbox states
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            // Clear interests array if going back from results
            if (questionNum === 5) {
                interests.length = 0;
            }
            
            // Handle going back when state question was skipped
            if (questionNum === 4 && answers.age && ['infant', 'kid', 'junior-high', 'high-school'].includes(answers.age)) {
                currentQuestion = 2; // Go back to gender question
            } else if (questionNum === 5 && answers.age && ['infant', 'kid', 'junior-high', 'high-school'].includes(answers.age)) {
                currentQuestion = 4; // Go back to situation question
            } else {
                currentQuestion = questionNum - 1;
            }
            
            updateProgress();
            showQuestion(currentQuestion);
        }

        function showQuestion(questionNum) {
            document.querySelectorAll('.question').forEach(q => q.classList.remove('active'));
            document.getElementById(`q${questionNum}`).classList.add('active');
        }

        function updateProgress() {
            let totalQuestionsForUser = totalQuestions;
            // If younger age group, they skip state question, so only 4 questions total
            if (answers.age && ['infant', 'kid', 'junior-high', 'high-school'].includes(answers.age)) {
                totalQuestionsForUser = 4;
            }
            
            let progressQuestions = currentQuestion - 1;
            // Adjust for skipped question
            if (currentQuestion >= 4 && answers.age && ['infant', 'kid', 'junior-high', 'high-school'].includes(answers.age)) {
                progressQuestions = currentQuestion - 2; // Account for skipped state question
            }
            
            const progress = Math.min(progressQuestions / totalQuestionsForUser * 100, 100);
            document.getElementById('progress-bar').style.width = progress + '%';
        }

        function showResults() {
            document.querySelector('.question.active').classList.remove('active');
            document.getElementById('results').style.display = 'block';
            
            const recommendations = findMinistries();
            const resultsDiv = document.getElementById('ministry-recommendations');
            
            let html = '';
            recommendations.forEach(ministry => {
                html += `
                    <div class="ministry-item">
                        <h3>${ministry.name}</h3>
                        <p>${ministry.description}</p>
                        <p class="details">${ministry.details}</p>
                    </div>
                `;
            });
            resultsDiv.innerHTML = html;
            
            // Update progress bar to 100%
            document.getElementById('progress-bar').style.width = '100%';
            
            // Trigger confetti celebration!
            triggerConfetti();
        }

        function triggerConfetti() {
            // Create confetti container
            const confettiContainer = document.createElement('div');
            confettiContainer.className = 'confetti-container';
            document.body.appendChild(confettiContainer);
            
            // Create multiple confetti pieces
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    createConfettiPiece(confettiContainer);
                }, i * 50); // Stagger the confetti creation
            }
            
            // Clean up after animation
            setTimeout(() => {
                document.body.removeChild(confettiContainer);
            }, 4000);
        }

        function createConfettiPiece(container) {
            const confetti = document.createElement('div');
            confetti.className = `confetti confetti-${Math.floor(Math.random() * 6) + 1}`;
            
            // Random horizontal position
            confetti.style.left = Math.random() * 100 + '%';
            
            // Random size variation
            const size = Math.random() * 6 + 4; // 4-10px
            confetti.style.width = size + 'px';
            confetti.style.height = size + 'px';
            
            // Random animation duration
            confetti.style.animationDuration = (Math.random() * 2 + 2) + 's'; // 2-4 seconds
            
            container.appendChild(confetti);
            
            // Remove individual confetti piece after animation
            setTimeout(() => {
                if (confetti.parentNode) {
                    confetti.parentNode.removeChild(confetti);
                }
            }, 4000);
        }

        function findMinistries() {
            const matches = [];
            
            for (const [key, ministry] of Object.entries(ministries)) {
                let isMatch = true;
                
                // Check age
                if (ministry.age && !ministry.age.includes(answers.age)) {
                    isMatch = false;
                }
                
                // Check gender (if specified and not skipped)
                if (ministry.gender && answers.gender !== 'skip' && !ministry.gender.includes(answers.gender)) {
                    isMatch = false;
                }
                
                // Check state (if specified and not skipped)
                if (ministry.state && answers.state !== 'skip' && !ministry.state.includes(answers.state)) {
                    isMatch = false;
                }
                
                // Check situation (if ministry has situation requirements)
                if (ministry.situation && ministry.situation.length > 0) {
                    const hasMatchingSituation = ministry.situation.some(s => situation.includes(s));
                    if (!hasMatchingSituation) {
                        isMatch = false;
                    }
                }
                
                // Check interests (support multiple selections)
                if (interests.length > 0 && !interests.includes('all') && ministry.interest) {
                    const hasMatchingInterest = ministry.interest.some(i => interests.includes(i));
                    if (!hasMatchingInterest) {
                        isMatch = false;
                    }
                }
                
                if (isMatch) {
                    matches.push(ministry);
                }
            }
            
            // Special handling for kids - always show core options
            if (answers.age === 'kid' && matches.length < 2) {
                // Always include these for kids regardless of interest
                const coreKidsMinistries = [
                    ministries['st-edward-school'],
                    ministries['prep-kids'],
                    ministries['mass']
                ];
                
                coreKidsMinistries.forEach(ministry => {
                    if (ministry && !matches.some(m => m.name === ministry.name)) {
                        matches.push(ministry);
                    }
                });
                
                // Add Cub Scouts if they selected fellowship or all
                if (interests.includes('fellowship') || interests.includes('all')) {
                    if (!matches.some(m => m.name === ministries['cub-scouts'].name)) {
                        matches.push(ministries['cub-scouts']);
                    }
                }
            }
            
            // If no interests selected, show general options
            if (interests.length === 0) {
                return [
                    {
                        name: 'Select Your Interests',
                        description: 'Please go back and select what interests you to see personalized recommendations.',
                        details: 'Use the back button to choose your areas of interest.'
                    }
                ];
            }
            
            // If we still have no matches for any age group, show general options
            if (matches.length === 0) {
                return [
                    {
                        name: 'Parish Community',
                        description: 'We have many opportunities to get involved!',
                        details: 'Please contact the parish office at (615) 833-5520 for personalized recommendations.'
                    }
                ];
            }
            
            return matches;
        }

        function restart() {
            location.reload();
        }

        // Initialize progress bar
        updateProgress();

        // Hide loading overlay once page is fully loaded
        window.addEventListener('load', function() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 500);
            }
        });
    </script>
</body>
</html>
